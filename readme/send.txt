при появлении интернета, устройство открывает порт, и приветсвует сервер.
Сервер запоминает ip и порт

Если кто-то хочет написать сообщение кому-то, то он спрашивает сервер о адресе. а сервер передает эти данные зашифровах их
Так-же он передает данные, чтобы идентифицировать этого пользователя

клиент 2, получает данные напрямую от к1, и спрашивает сервер о их действительности, или проверяет их сам.
после этого пользователи подружились

и создают свой секретик

после этого, при всех дальнейших приветсвиях, они просто спрашивают сервер об адресе




вариант 2

при попытке завязать знакомство
к1 отправляет данные серверу
сервер пингует к2
а уже сам юзер к2 подтверждает или отвергает, и в первом случае сам отпрапавляет первые данные к к1